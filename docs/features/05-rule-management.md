# 规则管理（Rule Management）

## 功能概述
规则管理模块定义内容生产的核心规则，包括主题生成规则和文章生成规则。每条规则指定使用哪个API配置、生成哪种类型的内容、以及每次生成多少主题/文章。该模块是整个自动化流程的配置中枢，位于 `rule-management/` 目录。

## 业务逻辑
1. **规则创建与编辑**：
   - 通过 `ContentAuto_RuleManager` 完成规则的增删改查。
   - 规则包含：规则名称、类型（topic/article）、API配置选择、生成数量、分类选择等。
   - 规则创建后存储在 `content_auto_rules` 和 `content_auto_rule_items` 表中。
2. **规则类型**：
   - **主题规则（topic）**：定义如何为指定分类批量生成主题标题。
   - **文章规则（article）**：定义如何从主题生成完整文章正文。
3. **规则锁定机制**：
   - 调用 `is_rule_in_use()` 检查规则是否正被任务使用。
   - 正在使用的规则无法修改或删除，避免任务执行出错。
4. **规则验证**：
   - `validate_rule_data()` 确保必填字段完整（如规则名称、API配置ID等）。
   - `class-rule-params.php` 提供参数封装与验证辅助。
5. **关联数据管理**：
   - `class-rule-handler.php` 处理前端提交，协调规则与分类的多对多关系。
   - 删除规则时级联删除 `content_auto_rule_items`。

## 使用场景
- 新站启动：创建第一条主题规则和文章规则，自动产出首批内容。
- 分类策略：针对不同分类配置不同API和生成策略（高质量vs高产量）。
- API切换：规则修改时，更换API配置实现服务商迁移。
- 批量调整：暂停或删除不符合要求的规则，快速调整策略。

## 实际业务应用

### 1. 新站内容冷启动策略
**业务场景**：新建的科技博客网站，需要快速积累初始内容以获得搜索引擎收录。

**操作流程**：
- **第一步：创建主题生成规则**
  - 规则名称：`科技新闻主题-每日更新`
  - 规则类型：`topic`（主题生成）
  - 选择API：`通义千问-快速版`（成本低，速度快）
  - 选择分类：勾选"人工智能"、"区块链"、"5G通信"三个分类
  - 每分类生成数量：`20`个主题
  - 提示词模板：`基于{分类名称}生成{N}个新闻标题，要求时效性强、吸引眼球`

- **第二步：创建文章生成规则**
  - 规则名称：`科技文章-标准版`
  - 规则类型：`article`（文章生成）
  - 选择API：`通义千问-智能版`（质量好，成本适中）
  - 文章字数：1500-2000字
  - 发布状态：先保存为草稿，人工审核后发布

- **第三步：执行与监控**
  - 创建主题任务：一次性生成60个主题（3个分类 × 20）
  - 审核主题质量：删除不合适的20%，保留48个优质主题
  - 创建文章任务：选择48个主题生成文章
  - 人工审核：2天内审核完毕，发布42篇文章
  - SEO效果：10天后百度收录35篇，15天后开始有自然流量

**实际案例**：某个人开发者博客使用该策略，第一个月产出120篇技术文章，第二个月日均UV从0增长到500，第三个月达到2000UV，成功度过冷启动期。

### 2. 多分类差异化内容策略
**业务场景**：电商评测网站覆盖手机、笔记本、家电等多个品类，不同品类需要不同的内容风格。

**规则配置矩阵**：

| 分类 | 规则名称 | API配置 | 生成策略 | 字数 | 发布频率 |
|------|---------|---------|----------|------|---------|
| 手机评测 | 手机深度评测 | GPT-4（高质量） | 详细参数+使用体验 | 3000字 | 每周3篇 |
| 笔记本 | 笔记本快评 | 通义千问-智能版 | 快速上手体验 | 1500字 | 每周5篇 |
| 小家电 | 家电购买指南 | 通义千问-快速版 | 性价比分析 | 1000字 | 每天2篇 |
| 数码配件 | 配件推荐清单 | 文心一言 | 榜单+简评 | 800字 | 每天5篇 |

**操作流程**：
1. 创建4条不同的文章生成规则，对应4个品类
2. 每条规则配置不同的：
   - API模型（根据内容重要性和预算选择）
   - 角色描述（专业评测编辑 vs 消费顾问 vs 性价比猎手）
   - 文章结构模板（深度评测 vs 快速体验 vs 购买指南）
   - 发布规则（立即发布 vs 草稿待审）

**效果对比**：
- 采用统一规则：所有分类内容同质化严重，用户跳出率65%
- 采用差异化规则：内容风格匹配用户预期，跳出率降至42%
- SEO表现：手机评测类长尾词排名前3的比例从15%提升到38%
- 转化效果：通过affiliate链接的成交转化率提升120%

**实际案例**：某数码评测网站实施差异化策略后，手机分类采用深度长文+高端API，月均产出12篇精品文章，带来的广告收入相当于其他分类200篇文章的收入总和。

### 3. 热点追踪快速响应规则
**业务场景**：新闻资讯网站需要快速跟进突发热点事件，传统人工创作速度慢。

**操作流程**：
- **预设热点规则**（平时关闭，热点时启用）：
  - 规则名称：`突发热点-快速成文`
  - API配置：`GPT-4-turbo`（响应速度快，并发能力强）
  - 生成策略：`从多角度快速解读，每个角度800-1000字`
  - 发布设置：`立即发布`（跳过人工审核）

- **热点发生时的操作**：
  1. 在"关键词工具"中挖掘热点相关长尾词（如"苹果发布会 新品""iPhone 16 评测"）
  2. 手工添加20个热点主题到主题库
  3. 启用"突发热点"规则，一次性创建20篇文章任务
  4. 系统在30分钟内完成20篇文章生成
  5. 快速人工扫描，修正明显错误后发布
  6. 在搜索引擎和社交媒体推送链接

- **时效性收益**：
  - 传统人工：热点爆发后6小时才能产出首篇文章，错过流量高峰
  - AI辅助：热点爆发后1小时内发布10篇多角度文章，抢占先机
  - 流量效果：热点相关文章24小时内带来5万UV，是平时的50倍

**实际案例**：某科技媒体在"ChatGPT-4发布"当天，使用该策略在2小时内发布了15篇相关文章（新功能解读、竞品对比、行业影响分析等），抢占了百度"ChatGPT-4"相关词的前三页位置，单日UV突破20万，创历史新高。

### 4. SEO长尾词批量覆盖策略
**业务场景**：旅游攻略网站需要覆盖"城市+景点+攻略"的海量长尾词组合。

**批量规则创建**：
- **规则1：城市综合攻略**
  - 覆盖300个热门城市
  - 主题模板：`{城市}旅游攻略`、`{城市}自由行指南`、`{城市}美食推荐`
  - 生成量：每城市3个主题 × 300城市 = 900个主题
  
- **规则2：景点详细介绍**
  - 覆盖5000个知名景点
  - 主题模板：`{景点}游玩攻略`、`{景点}门票价格`、`{景点}开放时间`
  - 生成量：每景点2个主题 × 5000景点 = 10000个主题

- **规则3：季节性内容**
  - 主题模板：`{城市}{季节}旅游攻略`
  - 示例：`北京春季赏花攻略`、`三亚冬季度假指南`
  - 生成量：300城市 × 4季节 = 1200个主题

**执行计划**：
- 第1周：创建并执行城市综合攻略规则，产出900篇文章
- 第2-4周：批量执行景点介绍规则，每周产出800篇
- 第5周起：根据季节滚动执行季节性内容规则

**SEO效果**：
- 3个月后：12000篇文章收录率82%
- 长尾词覆盖：在百度前10页占据位置的长尾词达到8500个
- 自然流量：从日均2000UV增长到日均25000UV
- 转化效果：酒店/门票affiliate收入从月均3000元增至38000元

**实际案例**：某旅游UGC平台使用该策略，将"规则管理"作为内容生产的调度中枢，通过精细化的规则配置，在6个月内产出4万篇旅游攻略，成为百度旅游垂类的重要流量来源。

### 5. 多品牌矩阵内容管理
**业务场景**：营销公司为10个不同客户品牌提供内容服务，需要隔离管理各品牌的内容生产规则。

**规则命名规范**：
```
[品牌代码]-[内容类型]-[更新频率]
示例：
- BRAND_A-产品评测-每日
- BRAND_A-行业动态-每周
- BRAND_B-使用教程-每日
- BRAND_B-用户案例-每月
```

**规则矩阵示例**：
| 品牌 | 行业 | 规则数量 | API配置 | 月产出 | 人工审核率 |
|------|------|---------|---------|--------|-----------|
| 品牌A | SaaS软件 | 3条 | GPT-4 | 120篇 | 100%（高价值） |
| 品牌B | 电商服饰 | 5条 | 通义千问 | 300篇 | 30%（抽检） |
| 品牌C | 本地服务 | 2条 | 文心一言 | 60篇 | 80% |

**管理策略**：
1. 为每个品牌创建独立的品牌资料（语调、价值观、目标受众）
2. 规则关联对应品牌资料，确保生成内容符合品牌调性
3. 使用规则名称前缀快速筛选和批量操作
4. 定期对比各品牌规则的成功率和主题利用率，优化配置
5. 在仪表盘通过规则维度统计各品牌的内容产出和质量

**实际案例**：某内容营销公司服务15个B2B客户，通过规则化管理，将内容团队从18人精简到5人，客户满意度反而从75分提升到88分，原因是规则确保了内容的一致性和及时性。

### 6. 规则A/B测试优化
**业务场景**：不确定哪种内容风格更受用户欢迎，通过A/B测试找到最优规则配置。

**测试设计**：
- **规则A：专业深度版**
  - API：GPT-4
  - 角色描述：`资深行业分析师，注重数据和逻辑`
  - 文章结构：引言+市场分析+技术解读+趋势预测+结论
  - 字数：2500-3000字
  
- **规则B：通俗易懂版**
  - API：通义千问
  - 角色描述：`科技博主，用大白话讲解复杂概念`
  - 文章结构：痛点+解决方案+产品推荐+总结
  - 字数：1200-1500字

**测试流程**：
1. 同一批50个主题，分别用规则A和规则B生成文章
2. 两组文章同时发布，使用不同的URL slug区分
3. 追踪30天数据：
   - 页面浏览量（PV）
   - 平均停留时间
   - 跳出率
   - 社交分享次数
   - 搜索引擎排名
   - 转化率（如果有）

**测试结果示例**：
| 指标 | 规则A（专业版） | 规则B（通俗版） | 差异 |
|------|----------------|----------------|------|
| 平均PV | 850 | 1,200 | +41% |
| 停留时间 | 4分30秒 | 2分50秒 | -37% |
| 跳出率 | 52% | 48% | -4% |
| 分享次数 | 12 | 38 | +217% |
| 转化率 | 2.8% | 3.5% | +25% |

**结论与调整**：
- 规则B（通俗版）流量和转化更好，但用户深度阅读不足
- 最优策略：创建规则C，融合两者优点
- 规则C配置：通俗的导言+专业的中间部分+实用的总结
- 执行规则C后，综合效果提升60%

**实际案例**：某金融科普网站通过规则A/B测试，发现"理财小白指南"类文章使用通俗风格效果更好，而"投资策略分析"类文章专业风格更受欢迎，据此创建了8条细分规则，内容ROI提升2.5倍。

## 技术实现
- 数据表：`content_auto_rules`（规则主表）、`content_auto_rule_items`（规则与分类关系表）。
- 核心类：
  - `ContentAuto_RuleManager`：规则管理逻辑。
  - `ContentAuto_RuleHandler`：前端表单处理与验证。
  - `ContentAuto_RuleParams`：参数封装类。
- 界面：
  - `rule-management/views/rules-list.php`（规则列表）
  - `rule-management/views/rule-management.php`（规则编辑表单）
- JavaScript：`rule-management/assets/js/rule-management.js` 处理AJAX和表单交互。

## 相关文件
- `rule-management/class-rule-manager.php`（规则管理核心）
- `rule-management/class-rule-handler.php`（表单处理）
- `rule-management/class-rule-params.php`（参数封装）
- `rule-management/views/rules-list.php`（规则列表页）
- `rule-management/views/rule-management.php`（规则编辑页）
- `rule-management/assets/js/rule-management.js`（前端交互）
- `shared/database/class-database.php`（数据库操作）
