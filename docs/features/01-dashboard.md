# 仪表盘（Dashboard）

## 功能概述
仪表盘是插件的中枢页面，用于展示内容生产系统的总体运行情况。页面在 `dashboard/views/enhanced-dashboard.php` 中实现，汇总任务队列、主题与文章生成、向量聚类以及分类缓存等关键指标，帮助运营人员快速了解系统健康度与产出效率。

## 业务逻辑
1. **统计聚合**：
   - 调用 `ContentAuto_Database::get_dashboard_stats()` 获取主题、文章、系统运行等统计数据。
   - 通过 `ContentAuto_JobQueue::get_queue_status()` 和 `get_vector_generation_stats()` 获取任务队列与向量生成情况。
2. **分类向量缓存管理**：
   - 提供刷新分类向量缓存的操作，提交后触发 `content_auto_refresh_category_cache()` 重新计算最子级分类的向量信息。
   - 统计分类覆盖率、主题匹配率等数据，辅助评估分类体系质量。
3. **任务监控**：
   - 展示任务处理速度、失败重试情况、手动主题匹配状态等信息。
   - 调用 `ContentAuto_Category_Filter`（若启用）筛选分类，计算叶子分类数量。
4. **可视化展示**：
   - 通过页面内置的卡片、图表展示每日产出、成功率、待处理队列等信息。

## 使用场景
- 日常运营巡检：了解今日产出、成功率、任务积压情况。
- 故障排查：发现任务处理阻塞、分类向量计算失败等问题。
- 策略优化：根据成功率、主题利用率评估规则配置是否需要调整。

## 实际业务应用

### 1. 内容运营日报监控
**业务场景**：内容团队负责人每天早上登录后台，通过仪表盘快速掌握昨日内容生产情况。

**操作流程**：
- 查看"日均输出"指标，确认昨日是否达成每日50篇文章的KPI目标
- 检查"成功率"数据，若低于90%需要进入调试工具查看失败原因
- 观察"待处理队列"数量，若超过100条说明任务积压，需要检查API配额或服务器性能
- 查看"主题利用率"，若低于60%说明主题库充足，可以暂停主题生成任务

**实际案例**：某电商网站运营团队设定每日产出80篇产品评测文章，通过仪表盘发现成功率从95%下降到65%，点击查看详情后发现是API密钥配额耗尽，及时更换备用API配置，恢复正常产出。

### 2. 分类向量优化工作流
**业务场景**：网站新增了"智能家居"一级分类及30个子分类，需要让系统能够自动将相关主题匹配到正确分类。

**操作流程**：
- 在WordPress后台添加完新分类结构后，返回仪表盘
- 点击"刷新分类向量缓存"按钮，系统自动为所有叶子分类生成语义向量
- 查看"分类覆盖率"从85%提升到92%，说明新分类已纳入向量体系
- 观察"手工主题未匹配数量"从120降低到15，说明历史未分类主题已自动归类
- 创建新的主题生成规则，指定"智能家居"分类开始自动生产内容

**实际案例**：某科技资讯网站扩展了AI、区块链、元宇宙等新兴技术分类，通过刷新分类缓存，系统自动将300多条手工导入的相关主题匹配到正确分类，节省了2天人工分类时间。

### 3. 任务积压排查与优化
**业务场景**：运营人员发现网站首页最新文章停留在3小时前，怀疑内容生成系统出现故障。

**操作流程**：
- 打开仪表盘，查看"队列状态"发现有68条待处理任务
- 检查"最后活动时间"显示"2小时前"，确认队列处理器停滞
- 查看"向量生成统计"发现"处理中任务"为0，说明不是向量计算卡住
- 进入"调试工具"查看日志，发现API返回429错误（请求频率过高）
- 在"API设置"中切换到备用API配置，返回仪表盘观察队列开始消化
- 30分钟后队列降至10条以下，任务处理速度从0恢复到每分钟2-3篇

**实际案例**：某新闻网站在突发热点事件时创建了大量主题任务，导致主API触发限流。通过仪表盘快速定位问题后，启用了三个备用API并行处理，将120条积压任务在1小时内清空，避免错过热点时效性。

### 4. 内容质量评估与调整
**业务场景**：网站运营一个月后，需要评估自动化内容系统的整体效果，决定是否需要调整规则配置。

**操作流程**：
- 查看"主题总数"和"已用主题数"，计算主题利用率为78%，说明主题质量较高
- 对比"文章总数"与"已发布文章数"，发现发布率为92%，其余8%为草稿状态需人工审核
- 观察"向量覆盖率"达到96%，说明主题向量生成稳定，聚类功能正常
- 检查"叶子分类数量"与"分类覆盖率"，确认所有200个末级分类都已纳入自动分配体系
- 分析"平均处理速度"为每小时12篇，与API调用频率匹配，无性能瓶颈

**数据解读**：
- **主题利用率78%** → 说明AI生成的主题质量较好，大部分被采纳用于文章生成
- **文章发布率92%** → 说明内容质量基本达标，只有少量需人工介入
- **向量覆盖率96%** → 说明向量服务稳定，支持智能分类和相似度匹配
- **成功率波动** → 若某日成功率骤降，可能是API服务异常或网络波动，需及时切换

### 5. 多站点批量运营监控
**业务场景**：运营团队同时管理10个细分领域网站（美食、旅游、科技等），需要集中监控各站点内容产出。

**操作建议**：
- 每个站点独立部署插件，配置不同的API和规则
- 通过浏览器多标签页同时打开各站点仪表盘，快速巡检
- 重点关注"成功率"和"队列状态"，优先处理异常站点
- 对比各站点"日均输出"，评估不同领域的内容生产效率
- 定期导出统计数据，分析各站点的主题利用率和文章质量趋势

**实际案例**：某内容矩阵公司运营15个垂直领域网站，通过统一的仪表盘监控体系，发现"健康养生"站点的主题利用率仅50%（其他站点均在70%以上），分析后发现该站点的主题提示词过于宽泛，调整后利用率提升到75%。

## 技术实现
- 页面使用原生 PHP 模板渲染，基于 WordPress 管理后台的标准 UI。
- 数据来自数据库封装层（`shared/database`）与任务队列服务（`shared/queue`）。
- 刷新分类缓存时通过 `wp_verify_nonce` 校验安全性，调用共享服务完成实际计算。
- 使用 `wp_enqueue_style` 在页面加载增强样式 `dashboard/assets/css/enhanced-dashboard.css`。

## 相关文件
- `dashboard/views/enhanced-dashboard.php`
- `shared/database/class-database.php`（统计数据来源）
- `shared/queue/class-job-queue.php`（队列状态接口）
- `publish-settings/class-category-filter.php`（分类筛选辅助）
